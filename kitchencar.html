<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„ÉºÁî∑Â≠ê„Å®ÊñáÂåñÁ•≠„É≠„Éû„É≥„Çπ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;500&display=swap');
        body {
            font-family: 'Kiwi Maru', serif;
            background-color: #1a1a1a;
            margin: 0;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        .text-shadow {
            text-shadow: 1px 1px 3px rgba(0,0,0,0.9);
        }
        .bg-glass {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
        }
        .fade-in {
            animation: fadeIn 0.8s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .character-container {
            height: 50vh; /* ÁîªÂÉè„ÇíÁîªÈù¢ÂÜÖ„Å´Âèé„ÇÅ„Çã„Åü„ÇÅÂ∞ë„Åó‰Ωé„ÇÅ„Å´Ë®≠ÂÆö */
            display: flex;
            align-items: flex-end;
            justify-content: center;
            width: 100%;
            position: relative;
            z-index: 5;
            padding-bottom: 10px;
        }
        .character-img {
            max-height: 100%;
            max-width: 90%;
            width: auto;
            object-fit: contain;
            transition: all 0.5s ease;
        }
        .choice-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        .choice-btn:active {
            background: rgba(249, 115, 22, 0.8);
            transform: scale(0.98);
        }
        .slide-layer {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            transition: opacity 2s ease-in-out;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        .ending-overlay {
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.85) 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SCENARIO = [
            {
                id: 'prologue',
                day: 'Prologue',
                location: 'Ê†°ÈñÄÂâç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_19.jpg',
                name: 'Áøî',
                text: '„ÅÇ„ÄÅ„Çª„É≥„Éë„Ç§„ÄÇ„Å°„Çá„Å£„Å®ÊôÇÈñì„ÅÇ„Çã?\n\nÂÆü„ÅØ„Åï„ÄÅÊñáÂåñÁ•≠„Åß„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„ÉºÂá∫„Åô„Åì„Å®„Å´„Å™„Å£„Åü„Çì„Å†„Åë„Å©„ÄÅ‰∫∫Êâã„ÅåË∂≥„Çä„Å™„Åè„Å¶„ÄÇ„Çª„É≥„Éë„Ç§„ÄÅÊâã‰ºù„Å£„Å¶„Åè„Çì„Å≠„Åà?',
                choices: [
                    { text: 'Èù¢ÁôΩ„Åù„ÅÜ! „ÇÑ„Å£„Å¶„Åø„Çã', points: 0, next: 'prologue_2' },
                    { text: 'Âøô„Åó„ÅÑ„Çì„Å†„Åë„Å©‚Ä¶', points: 0, next: 'prologue_retry' }
                ]
            },
            {
                id: 'prologue_2',
                day: 'Prologue',
                location: 'Ê†°ÈñÄÂâç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_19.jpg',
                name: 'Áøî',
                text: '„Éû„Ç∏„Åß!? Âä©„Åã„Çã„Çè„ÄÇ„Åò„ÇÉ„ÅÇÊòéÊó•„Åã„ÇâÊ∫ñÂÇôÂßã„ÇÅ„Çã„Åã„Çâ„ÄÅÊîæË™≤ÂæåÊù•„Å¶„Åè„Çå„Çà',
                next: 'day1'
            },
            {
                id: 'prologue_retry',
                day: 'Prologue',
                location: 'Ê†°ÈñÄÂâç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_19.jpg',
                name: 'Áøî',
                text: '„Åù„Åì„Çí„Å™„Çì„Å®„ÅãÔºÅ„Ç™„É¨‰∏Ä‰∫∫„Åò„ÇÉÁÑ°ÁêÜ„Å™„Çì„Å†„Çà„ÄÇÈ†º„ÇÄ„ÄÅ„Çª„É≥„Éë„Ç§ÔºÅ',
                choices: [
                    { text: '„Åó„Çá„ÅÜ„Åå„Å™„ÅÑ„Å™„ÅÇ„ÄÅÊâã‰ºù„ÅÜ„Çà', points: 0, next: 'prologue_2' }
                ]
            },
            {
                id: 'day1',
                day: 'Day 1',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„ÉºÂâç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_11.jpg',
                name: 'Áøî',
                text: 'ÊñáÂåñÁ•≠„Çπ„Éö„Ç∑„É£„É´„É°„Éã„É•„Éº„ÄÅ‰Ωï„Å´„Åô„Çã„ÅãÊ±∫„ÇÅ„Å≠„Åà„Å®„ÄÇ„Çª„É≥„Éë„Ç§„ÅØ„Å©„ÅÜÊÄù„ÅÜ?',
                choices: [
                    { text: 'ÂÆöÁï™„ÅÆ„Çø„Ç≥ÁÑº„Åç„Å®„Åã„ÅØ?', points: 0, feedback: '„ÄåÁÑ°Èõ£„Å†„Åë„Å©„ÄÅ„Ç™„É¨„ÅØ„ÇÇ„Å£„Å®Êîª„ÇÅ„Åü„ÅÑ„Çì„Å†„Çà„Å™„Äç', next: 'day1_post' },
                    { text: 'Áøî„Åè„Çì„ÅÆÂæóÊÑèÊñôÁêÜ„ÅßÂãùË≤†„Åó„Çà„ÅÜ„Çà', points: 10, feedback: '„Äå„Åä„ÄÅ„Çè„Åã„Å£„Å¶„Çì„Å™„ÄÇ„Ç™„É¨„Å´‰ªª„Åõ„Çç„Äç', next: 'day1_post' }
                ]
            },
            {
                id: 'day1_post',
                day: 'Day 1',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„ÉºÂâç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_11.jpg',
                name: 'Áøî',
                text: '„Åò„ÇÉ„ÅÇ„Ç™„É¨ÁâπË£Ω„ÅÆ„Ç¨„Éë„Ç™„É©„Ç§„Çπ„Å®„Éà„É†„É§„É†„ÇØ„É≥È∫∫„ÅßË°å„Åè„Çè„ÄÇ„Ç¢„Ç∏„Ç¢„É≥„Éï„É•„Éº„Ç∏„Éß„É≥„Å£„Å¶„Åì„Å®„Åß',
                next: 'day2'
            },
            {
                id: 'day2',
                day: 'Day 2',
                location: 'ÂïÜÂ∫óË°ó',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei01.jpg',
                name: 'Áøî',
                text: 'ÊùêÊñô‰ªïÂÖ•„Çå„Å´‰ªò„ÅçÂêà„Å£„Å¶„Åè„Çå„ÄÇ„Éê„Ç§„ÇØ„ÅÆÂæå„Çç‰πó„Å£„Å¶„Åë„Çà',
                choices: [
                    { text: '„Å°„Çá„Å£„Å®ÊÄñ„ÅÑ„Åã„ÇÇ‚Ä¶', points: 0, feedback: '„ÄåÂ§ß‰∏àÂ§´„Å†„Å£„Å¶„ÄÇ„Éò„É´„É°„ÉÉ„ÉàË¢´„Å£„Å¶„Å™„Äç', next: 'day2_post' },
                    { text: 'Ê•Ω„Åó„Åø! ‰πó„Çä„Åü„ÅÑÔºÅ', points: 10, feedback: '„Äå„Åù„Å£„Åã„ÄÇ„Åò„ÇÉ„ÅÇÂÆâÂÖ®ÈÅãËª¢„Åô„Çã„Çè„Äç', next: 'day2_post' }
                ]
            },
            {
                id: 'day2_post',
                day: 'Day 2',
                location: 'Ëµ∞Ë°å‰∏≠',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei01.jpg',
                name: 'Áøî',
                text: '„Çª„É≥„Éë„Ç§„ÄÅ„Åó„Å£„Åã„ÇäÊé¥„Åæ„Å£„Å¶„Çç„Çà',
                next: 'day3'
            },
            {
                id: 'day3',
                day: 'Day 3',
                location: 'ÁæéË°ìÂÆ§',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_11.jpg',
                name: 'Áøî',
                text: '„Çª„É≥„Éë„Ç§„ÄÅÁúãÊùø„ÅÆ„Éá„Ç∂„Ç§„É≥„Å†„Åë„Å©„ÄÅ„Å©„Å£„Å°„Åå„ÅÑ„ÅÑ„Å®ÊÄù„ÅÜ? (A:„Ç∑„É≥„Éó„É´ vs B:„Éù„ÉÉ„Éó)',
                choices: [
                    { text: 'A„ÅÆÊñπ„ÅåË¶ã„ÇÑ„Åô„Åè„Å¶„ÅÑ„ÅÑ', points: 0, feedback: '„ÄåÁ¢∫„Åã„Å´„Åù„Å£„Å°„ÅÆ„Åª„ÅÜ„ÅåÁÑ°Èõ£„Åã„ÇÇ„Å™‚Ä¶„Äç', next: 'day3_post' },
                    { text: 'B„ÅÆÊñπ„ÅåÁøî„Åè„Çì„Çâ„Åó„Åè„Å¶Ê†ºÂ•Ω„ÅÑ„ÅÑ', points: 10, feedback: '„Äå„Ç™„É¨„ÅÆÂ•Ω„Åø„Çè„Åã„Å£„Å¶„Çì„Åò„ÇÉ„Çì„ÄÅ„Çª„É≥„Éë„Ç§„Äç', next: 'day3_post' }
                ]
            },
            {
                id: 'day3_post',
                day: 'Day 3',
                location: 'ÁæéË°ìÂÆ§',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_11.jpg',
                name: 'Áøî',
                text: 'B„ÅßË°å„Åè„Çè„ÄÇ‰∏ÄÁ∑í„Å´Ëâ≤Â°ó„Å£„Å¶„Åè„Çå„Çà',
                next: 'day4'
            },
            {
                id: 'day4',
                day: 'Day 4',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„Éº',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_spr.jpg',
                name: 'Áøî',
                text: 'Ë©¶‰Ωú‰Ωú„Å£„Åü„Åã„Çâ„ÄÅÂë≥Ë¶ã„Åó„Å¶„Åè„Çå',
                choices: [
                    { text: 'ÁæéÂë≥„Åó„ÅÑ! „Åß„ÇÇÁîò„Åø„Åå„ÇÇ„ÅÜÂ∞ë„Åó‚Ä¶', points: 10, feedback: '„Äå„Åù„Å£„Åã„ÄÇË™øÊï¥„Åó„Å¶„Åø„Çã„Çè„Äç', next: 'day4_post' },
                    { text: 'ÂÆåÁíß! „Åì„ÅÆ„Åæ„Åæ„Åß„ÅÑ„ÅÑ„Çà', points: 5, feedback: '„Äå„Éû„Ç∏„Åß? „ÅÇ„Çä„Åå„Å®„Å™„Äç', next: 'day4_post' }
                ]
            },
            {
                id: 'day4_post',
                day: 'Day 4',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„Éº',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_spr.jpg',
                name: 'Áøî',
                text: '„Çª„É≥„Éë„Ç§„ÅÆÊÑèË¶ã„ÄÅÂèÇËÄÉ„Å´„Å™„Çã„Çè„ÄÇÂë≥Ë¶ö„Çª„É≥„Çπ„ÅÑ„ÅÑ„Çì„Å†„Å™',
                next: 'day5'
            },
            {
                id: 'day5',
                day: 'Day 5',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„ÉºÂâç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_choco.jpg',
                name: 'Áøî',
                text: 'ÊñáÂåñÁ•≠ÊàêÂäü„Åó„Åü„Çâ„Åï„ÄÅ‰Ωï„Åã„ÅîË§íÁæé„Åè„Çå„Çì„ÅÆ?',
                choices: [
                    { text: '„ÉÄ„Ç§„Éä„Éº„Åß„ÅîÈ£ØÂ•¢„Å£„Å¶„ÅÇ„Åí„Çã', points: 0, feedback: '„Äå‰∏ÄÁï™È´ò„ÅÑ„É°„Éã„É•„Éº„ÅßÈ†º„ÇÄ„Çè„Äç', next: 'day6' },
                    { text: '„Éê„Ç§„ÇØ„Åß‰∏ÄÁ∑í„Å´„Éá„Éº„Éà„Åó„Å¶„ÅÇ„Åí„Çã', points: 10, feedback: '„Äå„Ç™„É¨„ÅÆ„Å®„Å£„Å¶„Åä„Åç„ÅÆÂ†¥ÊâÄ„Å´Ê°àÂÜÖ„Åô„Çã„Çè„Äç', next: 'day6' }
                ]
            },
            {
                id: 'day6',
                day: 'Day 6',
                location: 'Ë≥ºË≤∑ÈÉ®Ââç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_tar.jpg',
                name: 'Áøî',
                text: '„É§„Éô„Åà„ÄÅÈ£üÊùê„ÅÆ‰∏ÄÈÉ®„ÅåÂ±ä„ÅÑ„Å¶„Å≠„Åà‚Ä¶',
                choices: [
                    { text: 'Âà•„ÅÆÊ•≠ËÄÖÊé¢„Åù„ÅÜ', points: 0, feedback: '„ÄåÊôÇÈñì„Å≠„Åà„Çà‚Ä¶„Äç', next: 'day6_post' },
                    { text: 'Ë¶™Êàö„ÅÆÂÖ´ÁôæÂ±ã„Å´ÈõªË©±„Åó„Å¶„Åø„Çã', points: 15, feedback: '„Äå„Éû„Ç∏„Åß!? Âä©„Åã„Çã!„Äç', next: 'day6_post' }
                ]
            },
            {
                id: 'day6_post',
                day: 'Day 6',
                location: 'Ë≥ºË≤∑ÈÉ®Ââç',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_tar.jpg',
                name: 'Áøî',
                text: '„Çª„É≥„Éë„Ç§„ÄÅÊú¨ÂΩì„Å´Âä©„Åã„Å£„Åü„Çè„ÄÇ„Çª„É≥„Éë„Ç§„Åå„ÅÑ„Å¶„Åè„Çå„Å¶„Çà„Åã„Å£„Åü',
                next: 'day7'
            },
            {
                id: 'day7',
                day: 'Day 7',
                location: 'Âªä‰∏ã',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_19.jpg',
                name: 'Áøî',
                text: '„ÉÅ„É©„Ç∑ÈÖç„Çä„Åô„Å£„Åã„ÄÇ‰∏ÄÁ∑í„Å´Ê†°ÂÜÖÂõû„Çç„ÅÜ„Åú',
                choices: [
                    { text: 'Áøî„Åè„Çì„ÄÅÈ†º„ÇÇ„Åó„ÅÑ„Å≠', points: 5, feedback: '„Äå„Åù„Çì„Å™„Çì„Åò„ÇÉ„Å≠„Åà„Çà„Äç', next: 'day7_post' },
                    { text: '‰∫å‰∫∫„ÅßÈ†ëÂºµ„Çç„ÅÜ„Å≠', points: 10, feedback: '„Äå„ÅÇ„ÅÇ„ÄÅ„Çª„É≥„Éë„Ç§„Å®‰∏ÄÁ∑í„Å™„ÇâÂÆåÁíß„Å†„Çè„Äç', next: 'day7_post' }
                ]
            },
            {
                id: 'day7_post',
                day: 'Day 7',
                location: 'Âªä‰∏ã',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_19.jpg',
                name: 'ÁâπÂæÖÁîü',
                text: '(ÂΩº„ÄÅÁßÅ„ÅÆ„Åì„Å®Ë™á„Çâ„Åó„Åí„Å´Ë©±„Åó„Å¶„Çã‚Ä¶)',
                next: 'day8'
            },
            {
                id: 'day8',
                day: 'Day 8',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„Éº',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei01.jpg',
                name: 'Áøî',
                text: 'ÊòéÂæåÊó•„ÅåÊú¨Áï™„Åã‚Ä¶Á∑äÂºµ„Åó„Å¶„Åç„Åü„Çè',
                choices: [
                    { text: 'ÁßÅ„ÇÇÁøî„Åè„Çì„Åå„ÅÑ„Çã„Åã„ÇâÈ†ëÂºµ„Çå„Çã', points: 15, feedback: '„Äå‚Ä¶„Åù„Å£„Åã„Äç', next: 'day9' },
                    { text: 'ÂΩìÊó•„ÇÇ„Çà„Çç„Åó„Åè„Å≠', points: 5, feedback: '„Äå„ÅÇ„ÅÇ„ÄÅ‰ªª„Åõ„Çç„Äç', next: 'day9' }
                ]
            },
            {
                id: 'day9',
                day: 'Day 9',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„ÉºÂâç„ÉªÂ§ïÊöÆ„ÇåÊôÇ',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_choco.jpg',
                name: 'Áøî',
                text: '„Åì„ÅÆÊï∞Êó•Èñì„ÄÅ„Çª„É≥„Éë„Ç§„Å®‰∏ÄÁ∑í„Å´Ê∫ñÂÇô„Åß„Åç„Å¶„ÄÅÊ•Ω„Åó„Åã„Å£„Åü„Çè',
                choices: [
                    { text: 'ÁßÅ„ÇÇ‰∏ÄÁ∑í„Å´„ÅÑ„Çå„Å¶„Çà„Åã„Å£„Åü„Çà', points: 20, feedback: '„Äå„Çª„É≥„Éë„Ç§„ÄÅ„Ç™„É¨‚Ä¶‚Ä¶‰Ωï„Åß„ÇÇ„Å≠„Åà„Äç', next: 'day10' },
                    { text: '„ÅÑ„ÅÑÊÄù„ÅÑÂá∫„Åå„Åß„Åç„Å¶„Çà„Åã„Å£„Åü„Å≠', points: 0, feedback: '„Äå„ÅÇ„ÅÇ„ÄÅÊòéÊó•„ÇÇ„Çà„Çç„Åó„Åè„Å™„Äç', next: 'day10' }
                ]
            },
            {
                id: 'day10',
                day: 'Day 10',
                location: '„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„Éº',
                image: 'https://nek0-tkdb.github.io/tools/img/shohei_19.jpg',
                name: 'Áøî',
                text: 'ÂÆåÂ£≤„Å†! „Çª„É≥„Éë„Ç§„ÅÆ„Åä„Åã„Åí„Å†„Çè',
                next: 'ending_check'
            }
        ];

        const SLIDE_IMAGES = [
            'https://nek0-tkdb.github.io/tools/img/shohei_19.jpg',
            'https://nek0-tkdb.github.io/tools/img/shohei_11.jpg',
            'https://nek0-tkdb.github.io/tools/img/shohei01.jpg',
            'https://nek0-tkdb.github.io/tools/img/shohei_spr.jpg',
            'https://nek0-tkdb.github.io/tools/img/shohei_choco.jpg',
            'https://nek0-tkdb.github.io/tools/img/shohei_tar.jpg'
        ];

        const GOOD_ENDING_FINAL_IMG = 'https://nek0-tkdb.github.io/tools/img/shohei_hol.jpg';

        const GOOD_ENDING_LINES = [
            { name: 'Áøî', text: '„Çª„É≥„Éë„Ç§„ÄÅ„Çà„Åã„Å£„Åü„ÇâÂæåÂ§úÁ•≠„ÅßËä±ÁÅ´‰∏ÄÁ∑í„Å´Ë¶ã„Å≠„Åà?' },
            { name: 'ÁâπÂæÖÁîü', text: '„ÅÜ„Çì„ÄÅË°å„Åç„Åü„ÅÑ„ÄÇ' },
            { name: '„Éä„É¨„Éº„Ç∑„Éß„É≥', text: 'Ê†°Â∫≠„ÅÆÈöÖ„ÄÇÂ§úÁ©∫„Å´Ëâ≤„Å®„Çä„Å©„Çä„ÅÆÊâì„Å°‰∏ä„ÅíËä±ÁÅ´„Åå‰∏ä„Åå„Çã„ÄÇ' },
            { name: 'Áøî', text: '„Å™„ÅÇ„ÄÅ„Çª„É≥„Éë„Ç§„ÄÇ„Ç™„É¨„ÄÅ„Åì„ÅÆÊñáÂåñÁ•≠„Åß„Çª„É≥„Éë„Ç§„Å®„ÇÇ„Å£„Å®‰∏ÄÁ∑í„Å´„ÅÑ„Åü„ÅÑ„Å£„Å¶ÊÄù„Å£„Åü„Çì„Å†„ÄÇ' },
            { name: 'Áøî', text: '‚Ä¶‚Ä¶„Çª„É≥„Éë„Ç§„ÅÆ„Åì„Å®„ÄÅÂ•Ω„Åç„Å†„ÄÇ‰ªò„ÅçÂêà„Å£„Å¶„Åè„Çå„Å≠„Åà?' },
            { name: 'ÁâπÂæÖÁîü', text: 'ÁßÅ„ÇÇ„ÄÅÁøî„Åè„Çì„ÅÆ„Åì„Å®„ÅåÂ•Ω„Åç„Å†„Çà„ÄÇ' },
            { name: '„Éä„É¨„Éº„Ç∑„Éß„É≥', text: 'Ëä±ÁÅ´„ÅÆÈü≥„Å´Á¥õ„Çå„Å¶„ÄÅ‰∫å‰∫∫„ÅØÈùô„Åã„Å´ÂæÆÁ¨ë„ÅøÂêà„Å£„Åü„ÄÇ' }
        ];

        const BAD_ENDING_LINES = [
            { name: 'Áøî', text: '„Çª„É≥„Éë„Ç§„ÄÅÊâã‰ºù„Å£„Å¶„Åè„Çå„Å¶„ÅÇ„Çä„Åå„Å®„Å™„ÄÇÂä©„Åã„Å£„Åü„Çè„ÄÇ' },
            { name: 'ÁâπÂæÖÁîü', text: '„ÅÜ„Çì„ÄÅÊ•Ω„Åó„Åã„Å£„Åü„Çà„ÄÇ' },
            { name: 'Áøî', text: '„Åò„ÇÉ„ÅÇ„Å™„ÄÇ„Åæ„ÅüÂ≠¶Ê†°„Åß„Å™„ÄÇ' },
            { name: 'ÁâπÂæÖÁîü', text: 'Ôºà‚Ä¶‚Ä¶„ÇÇ„Å£„Å®Á©çÊ•µÁöÑ„Å´Èñ¢„Çè„Çå„Å∞„ÄÅÈÅï„Å£„Åü„ÅÆ„Åã„Å™‚Ä¶‚Ä¶Ôºâ' },
            { name: '„Éä„É¨„Éº„Ç∑„Éß„É≥', text: 'ÁâπÂà•„Å™ÈÄ≤Â±ï„ÅØ„Å™„Åè„ÄÅÊñáÂåñÁ•≠„ÅÆ„Ç≠„ÉÉ„ÉÅ„É≥„Ç´„Éº„ÅØÂπï„ÇíÈñâ„Åò„Åü„ÄÇ' }
        ];

        function App() {
            const [gameState, setGameState] = useState('title');
            const [currentSceneId, setCurrentSceneId] = useState('prologue');
            const [affection, setAffection] = useState(0);
            const [isBgmOn, setIsBgmOn] = useState(false);
            const [feedbackText, setFeedbackText] = useState('');
            const [slideIndex, setSlideIndex] = useState(0);
            const [endingStep, setEndingStep] = useState(0);
            const [isSlideshowActive, setIsSlideshowActive] = useState(false);
            const [endingFinished, setEndingFinished] = useState(false);
            const [showChoices, setShowChoices] = useState(false); // ÈÅ∏ÊäûËÇ¢Ë°®Á§∫„Éï„É©„Ç∞
            
            const audioRef = useRef(null);
            const currentScene = SCENARIO.find(s => s.id === currentSceneId) || SCENARIO[0];

            useEffect(() => {
                if (audioRef.current) {
                    audioRef.current.loop = true;
                    if (isBgmOn) {
                        audioRef.current.play().catch(e => console.log("Play blocked"));
                    } else {
                        audioRef.current.pause();
                    }
                }
            }, [isBgmOn, gameState]);

            // „Çπ„É©„Ç§„Éâ„Ç∑„Éß„ÉºÂàá„ÇäÊõø„Åà
            useEffect(() => {
                let interval;
                if (isSlideshowActive) {
                    interval = setInterval(() => {
                        setSlideIndex(prev => (prev + 1) % SLIDE_IMAGES.length);
                    }, 4000); 
                }
                return () => clearInterval(interval);
            }, [isSlideshowActive]);

            const handleStart = () => {
                setGameState('playing');
                setCurrentSceneId('prologue');
                setAffection(0);
                setSlideIndex(0);
                setEndingStep(0);
                setIsSlideshowActive(false);
                setEndingFinished(false);
                setShowChoices(false);
            };

            const handleChoice = (choice) => {
                setAffection(prev => prev + (choice.points || 0));
                setShowChoices(false);
                if (choice.feedback) {
                    setFeedbackText(choice.feedback);
                    setTimeout(() => {
                        setFeedbackText('');
                        proceed(choice.next);
                    }, 1800);
                } else {
                    proceed(choice.next);
                }
            };

            const proceed = (nextId) => {
                if (nextId === 'ending_check') {
                    setGameState('ending');
                } else {
                    setCurrentSceneId(nextId);
                    setShowChoices(false);
                }
            };

            const getBgmUrl = () => {
                if (gameState === 'ending' && affection >= 100) {
                    return "https://nek0-tkdb.github.io/tools/media/kirakira.mp3";
                }
                return "https://nek0-tkdb.github.io/tools/media/kitchen_bgm.mp3";
            };

            const nextEndingStep = () => {
                const isGoodEnd = affection >= 100;
                const lines = isGoodEnd ? GOOD_ENDING_LINES : BAD_ENDING_LINES;
                
                if (endingStep < lines.length - 1) {
                    setEndingStep(prev => prev + 1);
                } else {
                    if (isGoodEnd) {
                        setIsSlideshowActive(true);
                        setEndingFinished(true);
                    } else {
                        setEndingFinished(true);
                    }
                }
            };

            // „Çø„Ç§„Éà„É´
            if (gameState === 'title') {
                return (
                    <div className="h-[100dvh] w-screen flex flex-col items-center justify-center bg-cover bg-center relative" style={{backgroundImage: `url(${SCENARIO[0].image})`}}>
                        <div className="absolute inset-0 bg-black/60"></div>
                        <div className="z-10 text-center text-white px-4">
                            <h1 className="text-2xl sm:text-4xl font-bold mb-8 text-shadow tracking-widest leading-tight">
                                „Ç≠„ÉÉ„ÉÅ„É≥„Ç´„ÉºÁî∑Â≠ê„Å®<br className="md:hidden" />ÊñáÂåñÁ•≠„É≠„Éû„É≥„Çπ
                            </h1>
                            <button 
                                onClick={handleStart}
                                className="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-full text-base font-bold transition-transform active:scale-95 shadow-2xl mb-6"
                            >
                                START
                            </button>
                            <div className="flex items-center justify-center gap-2">
                                <button 
                                    onClick={() => setIsBgmOn(!isBgmOn)}
                                    className="flex items-center gap-2 bg-white/10 px-4 py-2 rounded-lg text-[10px] font-bold"
                                >
                                    {isBgmOn ? "üîä BGM: ON" : "üîá BGM: OFF"}
                                </button>
                            </div>
                        </div>
                        <audio ref={audioRef} src={getBgmUrl()} />
                    </div>
                );
            }

            // „Ç®„É≥„Éá„Ç£„É≥„Ç∞
            if (gameState === 'ending') {
                const isGoodEnd = affection >= 100;
                const lines = isGoodEnd ? GOOD_ENDING_LINES : BAD_ENDING_LINES;
                const currentLine = !endingFinished ? lines[endingStep] : null;

                return (
                    <div className="h-[100dvh] w-screen flex flex-col items-center justify-center bg-black relative overflow-hidden">
                        {!isSlideshowActive ? (
                            <div 
                                className="absolute inset-0 bg-cover bg-center transition-opacity duration-1000"
                                style={{
                                    backgroundImage: `url(${isGoodEnd ? GOOD_ENDING_FINAL_IMG : SCENARIO[0].image})`,
                                    opacity: 0.6
                                }}
                            />
                        ) : (
                            SLIDE_IMAGES.map((img, idx) => (
                                <div 
                                    key={idx}
                                    className="slide-layer"
                                    style={{
                                        backgroundImage: `url(${img})`,
                                        opacity: slideIndex === idx ? 0.6 : 0
                                    }}
                                />
                            ))
                        )}
                        
                        <div className="absolute inset-0 ending-overlay"></div>
                        <audio ref={audioRef} src={getBgmUrl()} autoPlay={isBgmOn} loop />
                        
                        <div className="relative z-10 h-full w-full flex flex-col items-center justify-end">
                            <div className="absolute top-4 left-4 flex flex-col gap-2 z-20">
                                <div className={`bg-black/70 px-3 py-0.5 rounded-full text-[9px] border uppercase tracking-widest font-bold ${isGoodEnd ? 'text-pink-400 border-pink-400/30' : 'text-gray-400 border-white/10'}`}>
                                    {isGoodEnd ? 'Happy Ending' : 'Normal Ending'}
                                </div>
                            </div>

                            <button onClick={() => setIsBgmOn(!isBgmOn)} className="absolute top-4 right-4 bg-black/70 text-white p-2 rounded-full z-20 border border-white/10">
                                {isBgmOn ? "üîä" : "üîá"}
                            </button>

                            <div className="w-full max-w-4xl px-4 relative z-20 pb-4 md:pb-10 fade-in">
                                <div className="bg-glass min-h-[140px] md:min-h-[180px] p-4 md:p-10 rounded-2xl border border-white/20 text-white shadow-2xl flex flex-col">
                                    {!endingFinished ? (
                                        <>
                                            <div className={`absolute top-[-0.8rem] left-6 md:left-10 px-4 md:px-10 py-1 rounded-lg text-xs font-bold text-shadow shadow-xl tracking-wider ${currentLine.name === 'Áøî' ? 'bg-orange-600' : currentLine.name === '„Éä„É¨„Éº„Ç∑„Éß„É≥' ? 'bg-gray-700' : 'bg-pink-600'}`}>
                                                {currentLine.name}
                                            </div>
                                            
                                            <div className="flex-grow pt-2">
                                                <p className="text-sm md:text-xl leading-relaxed text-shadow drop-shadow-sm font-medium whitespace-pre-wrap">
                                                    {currentLine.text}
                                                </p>
                                            </div>

                                            <button onClick={nextEndingStep} className="mt-2 w-full bg-white/5 p-2 rounded-xl text-center font-bold tracking-[0.2em] text-orange-400 text-xs md:text-base animate-pulse">
                                                NEXT
                                            </button>
                                        </>
                                    ) : (
                                        <div className="flex flex-col items-center justify-center py-2 text-center">
                                            <h2 className={`text-2xl md:text-4xl font-bold mb-1 tracking-widest ${isGoodEnd ? 'text-pink-400' : 'text-gray-400'}`}>
                                                {isGoodEnd ? 'EPILOGUE' : 'FINISH'}
                                            </h2>
                                            <p className="text-[10px] opacity-80 mb-4 italic">
                                                {isGoodEnd ? 'ÔΩû ÊñáÂåñÁ•≠„ÅÆÊÄù„ÅÑÂá∫„Å®ÂÖ±„Å´ ÔΩû' : `Ë¶™ÂØÜÂ∫¶: ${affection}`}
                                            </p>
                                            <button onClick={() => setGameState('title')} className="bg-white/10 text-white px-6 py-2 rounded-full font-bold border border-white/20 text-xs md:text-base">
                                                „Çø„Ç§„Éà„É´„Å´Êàª„Çã
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // „É°„Ç§„É≥„Éó„É¨„Ç§
            return (
                <div className="h-[100dvh] w-screen bg-black relative flex flex-col items-center overflow-hidden">
                    <audio ref={audioRef} src={getBgmUrl()} />
                    <div className="absolute inset-0 bg-cover bg-center transition-all duration-1000 opacity-30 blur-sm" style={{backgroundImage: `url(${currentScene.image})`}}></div>
                    
                    <div className="relative z-10 h-full w-full flex flex-col items-center justify-end">
                        <div className="absolute top-4 left-4 flex flex-col gap-1 z-20">
                            <div className="bg-black/70 text-white px-3 py-0.5 rounded-full text-[9px] border border-white/10 uppercase tracking-widest font-bold">
                                {currentScene.day} | {currentScene.location}
                            </div>
                            <div className="bg-black/70 text-pink-400 px-3 py-0.5 rounded-full text-[9px] border border-pink-400/30 flex items-center gap-1 font-bold w-fit">
                                ‚ô• {affection}
                            </div>
                        </div>

                        <button onClick={() => setIsBgmOn(!isBgmOn)} className="absolute top-4 right-4 bg-black/70 text-white p-2 rounded-full z-20 border border-white/10">
                            {isBgmOn ? "üîä" : "üîá"}
                        </button>

                        <div className="character-container">
                            <img 
                                src={currentScene.image} 
                                alt={currentScene.name}
                                className="character-img fade-in drop-shadow-[0_0_15px_rgba(0,0,0,0.8)]"
                                key={currentScene.image}
                            />
                        </div>

                        <div className="w-full max-w-4xl px-4 relative z-20 pb-4 md:pb-10">
                            <div className="bg-glass min-h-[140px] md:min-h-[170px] p-4 md:p-8 rounded-2xl border border-white/10 text-white shadow-2xl flex flex-col transition-all duration-300">
                                <div className="absolute top-[-0.8rem] left-6 md:left-10 bg-orange-600 px-6 py-0.5 rounded-lg text-xs font-bold text-shadow shadow-xl tracking-wider">
                                    {currentScene.name}
                                </div>
                                
                                <div className="flex-grow pt-2 overflow-y-auto max-h-[80px] md:max-h-[120px] pr-1 custom-scrollbar">
                                    <p className="text-sm md:text-xl leading-relaxed text-shadow font-medium whitespace-pre-wrap">
                                        {feedbackText || currentScene.text}
                                    </p>
                                </div>

                                {!feedbackText && (
                                    <div className="mt-3 flex flex-col gap-2">
                                        {/* ÈÅ∏ÊäûËÇ¢„Åå„ÅÇ„Çã„Åå„ÄÅ„Åæ„Å†Ë°®Á§∫„Éï„É©„Ç∞„ÅåÁ´ã„Å£„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÄÅNEXT„Éú„Çø„É≥„ÇíË°®Á§∫ */}
                                        {currentScene.choices && !showChoices && (
                                            <button 
                                                onClick={() => setShowChoices(true)}
                                                className="w-full bg-white/5 p-2 rounded-xl text-center font-bold tracking-[0.2em] text-orange-400 text-xs md:text-base animate-pulse border border-white/10"
                                            >
                                                NEXT
                                            </button>
                                        )}

                                        {/* ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫„Åô„Çã„Éï„Çß„Éº„Ç∫ */}
                                        {currentScene.choices && showChoices && (
                                            <div className="grid gap-2 grid-cols-1 md:grid-cols-2 fade-in">
                                                {currentScene.choices.map((choice, i) => (
                                                    <button 
                                                        key={i}
                                                        onClick={() => handleChoice(choice)}
                                                        className="choice-btn p-3 rounded-xl text-left text-shadow font-bold text-xs md:text-lg shadow-sm"
                                                    >
                                                        {choice.text}
                                                    </button>
                                                ))}
                                            </div>
                                        )}

                                        {/* Ê¨°„ÅÆ„Ç∑„Éº„É≥„Å∏ÈÄ≤„ÇÄ„Å†„Åë„ÅÆ„Éú„Çø„É≥ */}
                                        {!currentScene.choices && (
                                            <button 
                                                onClick={() => proceed(currentScene.next)}
                                                className="w-full bg-white/5 p-2 rounded-xl text-center font-bold tracking-[0.2em] text-orange-400 text-xs md:text-base animate-pulse border border-white/10"
                                            >
                                                TAP TO NEXT
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
