<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒ•è¨ˆç®—ãƒ„ãƒ¼ãƒ« v3.0</title>
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7ffec; /* æŸ”ã‚‰ã‹ãªèƒŒæ™¯è‰² */
        }
        .card {
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* é¸æŠçŠ¶æ…‹ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .attribute-button {
            transition: all 0.2s;
            background-color: #e5e7eb; /* gray-200 */
            color: #4b5563; /* gray-600 */
            border: 1px solid #d1d5db; /* gray-300 */
        }
        .attribute-button.selected {
            font-weight: 700;
            color: white !important;
            border-width: 2px;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.5); 
            transform: translateY(-2px);
        }
        /* å±æ€§ãƒœã‚¿ãƒ³ã‚’å°ã•ãã—ã¦6ã¤ä¸¦ã¹ã‚„ã™ãã™ã‚‹ */
        .attribute-button-compact {
            padding: 0.5rem 0.25rem; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å°ã•ã */
            font-size: 0.75rem; /* æ–‡å­—ã‚’å°ã•ã */
        }
        .text-2xs {
            font-size: 0.65rem; 
            line-height: 1rem;
        }
        /* ã‚¹ãƒ­ãƒƒãƒˆã‚’éš ã™ãŸã‚ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .slot-container {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 1000px; /* åˆæœŸè¡¨ç¤ºç”¨ */
            opacity: 1;
            overflow: hidden;
        }
        .slot-container.hidden {
            max-height: 0;
            opacity: 0;
            margin-bottom: 0 !important;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div id="app" class="w-full max-w-xl bg-white p-6 sm:p-8 rounded-xl card border border-gray-200">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6 border-b pb-2">
            ãƒ‡ãƒãƒ•è¨ˆç®—ãƒ„ãƒ¼ãƒ« v3.0 (æœ€å¤§6ä¸»åŠ›)
        </h1>

        <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="space-y-6">
            
            <!-- å‘³æ–¹å´ã®å…¥åŠ›ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4">
                    <span class="mr-2">ğŸ›¡ï¸</span>å‘³æ–¹æƒ…å ± (è‡ªåˆ†)
                </h2>
                
                <div class="space-y-4 pr-2">
                    <!-- ä¸»åŠ›1ã‹ã‚‰6ã¾ã§ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‹•çš„ã«ç”Ÿæˆ -->
                    <script>
                        const localNumSlots = 6;
                        document.write('<div id="myInputs">');
                        for(let i = 1; i <= localNumSlots; i++) {
                            const hiddenClass = i > 1 ? 'hidden' : ''; // ä¸»åŠ›2ä»¥é™ã¯åˆæœŸéè¡¨ç¤º
                            document.write(`
                                <div id="mySlot${i}" class="slot-container p-3 bg-indigo-100 rounded-md border border-indigo-200 mb-4 last:mb-0 ${hiddenClass}">
                                    <h3 class="font-bold text-indigo-600 mb-2">ä¸»åŠ›${i} (vs æ•µä¸»åŠ›${i})</h3>
                                    <!-- æˆ¦åŠ›å…¥åŠ› -->
                                    <div class="mb-3">
                                        <label for="myPower${i}" class="block text-sm font-medium text-gray-700">æˆ¦åŠ› (ä¸‡å˜ä½)</label>
                                        <input type="number" id="myPower${i}" min="1"
                                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500 transition" oninput="calculateDebuff()">
                                    </div>
                                    <!-- å±æ€§é¸æŠ -->
                                    <div>
                                        <span class="block text-sm font-medium text-gray-700 mb-2">å±æ€§</span>
                                        <div id="myAttribute${i}" class="flex justify-between space-x-1">
                                            <button type="button" data-attribute="fire" data-bg="bg-red-500" data-border="border-red-600" class="attribute-button attribute-button-compact flex-1 py-2 rounded-lg font-semibold" onclick="selectAttribute('my', ${i}, 'fire')">ğŸ”¥ ç«</button>
                                            <button type="button" data-attribute="water" data-bg="bg-blue-500" data-border="border-blue-600" class="attribute-button attribute-button-compact flex-1 py-2 rounded-lg font-semibold" onclick="selectAttribute('my', ${i}, 'water')">ğŸ’§ æ°´</button>
                                            <button type="button" data-attribute="grass" data-bg="bg-green-500" data-border="border-green-600" class="attribute-button attribute-button-compact flex-1 py-2 rounded-lg font-semibold" onclick="selectAttribute('my', ${i}, 'grass')">ğŸŒ¿ è‰</button>
                                        </div>
                                    </div>
                                </div>
                            `);
                        }
                        document.write('</div>');
                    </script>
                </div>
                <!-- å‘³æ–¹ä¸»åŠ›è¿½åŠ ãƒœã‚¿ãƒ³ -->
                <button id="myAddSlotButton" onclick="addMySlot()"
                        class="w-full mt-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-lg shadow-md transform transition active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-indigo-300">
                    å‘³æ–¹ä¸»åŠ›è¿½åŠ  (ç¾åœ¨ 1 / 6)
                </button>
            </div>

            <!-- æ•µå´ã®å…¥åŠ›ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                <h2 class="text-xl font-semibold text-red-700 mb-4">
                    <span class="mr-2">âš”ï¸</span>æ•µæƒ…å ± (ç›¸æ‰‹)
                </h2>

                <div class="space-y-4 pr-2">
                    <!-- ä¸»åŠ›1ã‹ã‚‰6ã¾ã§ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‹•çš„ã«ç”Ÿæˆ -->
                    <script>
                        const localNumSlotsEnemy = 6;
                        document.write('<div id="enemyInputs">');
                        for(let i = 1; i <= localNumSlotsEnemy; i++) {
                            const hiddenClass = i > 1 ? 'hidden' : ''; // ä¸»åŠ›2ä»¥é™ã¯åˆæœŸéè¡¨ç¤º
                            document.write(`
                                <div id="enemySlot${i}" class="slot-container p-3 bg-red-100 rounded-md border border-red-200 mb-4 last:mb-0 ${hiddenClass}">
                                    <h3 class="font-bold text-red-600 mb-2">ä¸»åŠ›${i} (vs å‘³æ–¹ä¸»åŠ›${i})Â </h3>
                                    <!-- æˆ¦åŠ›å…¥åŠ› -->
                                    <div class="mb-3">
                                        <label for="enemyPower${i}" class="block text-sm font-medium text-gray-700">æˆ¦åŠ› (ä¸‡å˜ä½)</label>
                                        <input type="number" id="enemyPower${i}" min="1"
                                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-red-500 focus:ring-red-500 transition" oninput="calculateDebuff()">
                                    </div>
                                    <!-- å±æ€§é¸æŠ -->
                                    <div>
                                        <span class="block text-sm font-medium text-gray-700 mb-2">å±æ€§</span>
                                        <div id="enemyAttribute${i}" class="flex justify-between space-x-1">
                                            <button type="button" data-attribute="fire" data-bg="bg-red-500" data-border="border-red-600" class="attribute-button attribute-button-compact flex-1 py-2 rounded-lg font-semibold" onclick="selectAttribute('enemy', ${i}, 'fire')">ğŸ”¥ ç«</button>
                                            <button type="button" data-attribute="water" data-bg="bg-blue-500" data-border="border-blue-600" class="attribute-button attribute-button-compact flex-1 py-2 rounded-lg font-semibold" onclick="selectAttribute('enemy', ${i}, 'water')">ğŸ’§ æ°´</button>
                                            <button type="button" data-attribute="grass" data-bg="bg-green-500" data-border="border-green-600" class="attribute-button attribute-button-compact flex-1 py-2 rounded-lg font-semibold" onclick="selectAttribute('enemy', ${i}, 'grass')">ğŸŒ¿ è‰</button>
                                        </div>
                                    </div>
                                </div>
                            `);
                        }
                        document.write('</div>');
                    </script>
                </div>
                <!-- æ•µä¸»åŠ›è¿½åŠ ãƒœã‚¿ãƒ³ -->
                <button id="enemyAddSlotButton" onclick="addEnemySlot()"
                        class="w-full mt-4 py-2 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg shadow-md transform transition active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-red-300">
                    æ•µä¸»åŠ›è¿½åŠ  (ç¾åœ¨ 1 / 6)
                </button>
            </div>
        </div>

        
        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="results" class="mt-8 pt-6 border-t border-gray-300 space-y-4">
            <h2 class="text-2xl font-bold text-gray-800 text-center">
                è¨ˆç®—çµæœ
            Â  Â  </h2>

            <!-- å±æ€§è£œæ­£è©³ç´°ï¼ˆå…¥åŠ›ã•ã‚ŒãŸã‚‚ã®ã ã‘å‹•çš„ã«è¡¨ç¤ºï¼‰ -->
            <div id="multiplierText" class="text-center text-gray-600 font-medium p-3 bg-gray-50 rounded-lg border border-gray-200 max-h-40 overflow-y-auto">
                <p class="text-sm text-gray-500">ä¸»åŠ›ã”ã¨ã®å±æ€§è£œæ­£ç‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™ (å…¥åŠ›ãŒã‚ã£ãŸçµ„ã®ã¿)</p>
            </div>
            
            <!-- åˆè¨ˆæˆ¦åŠ›ã‚µãƒãƒªãƒ¼ -->
            <div id="summaryPower" class="text-center p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-gray-700 font-semibold shadow-sm">
                <p class="text-lg">å‘³æ–¹æœ‰åŠ¹åˆè¨ˆæˆ¦åŠ›: <span id="effectiveTotalPower" class="text-yellow-800 font-extrabold">0</span> ä¸‡</p>
                <p class="text-lg">æ•µåˆè¨ˆæˆ¦åŠ›: <span id="enemyTotalPower" class="text-red-600 font-extrabold">0</span> ä¸‡</p>
            </div>

            <!-- å¿…è¦ãªç­æ•°ã¨äººæ•° -->
            <div id="output" class="text-center p-4 rounded-lg bg-gray-100 border border-gray-300 shadow-md">
                
                <p class="text-lg text-gray-700 font-semibold mb-2">å¿…è¦ãªç­ã®æ•° (6äºº/ç­)</p>
                <p id="neededSquads" class="text-4xl font-extrabold text-gray-600">å…¥åŠ›å¾…ã¡</p>
                
                <p class="text-lg text-gray-700 font-semibold mb-2 mt-4">å¿…è¦ãªè¿½åŠ äººæ•°</p>
                <p id="neededPeople" class="text-3xl font-extrabold text-gray-500">å…¥åŠ›å¾…ã¡</p>
            </div>
            
            <!-- ã‹ã‹ã‚‹æ™‚é–“ã®ç›®å®‰ (æ–°è¦è¿½åŠ ) -->
            <div id="timeEstimate" class="mt-4 p-4 rounded-lg bg-indigo-50 border border-indigo-300 shadow-md">
                <p class="text-lg text-gray-700 font-semibold mb-2">ãƒ‡ãƒãƒ•ã«ã‹ã‹ã‚‹æ™‚é–“ã®ç›®å®‰</p>
                <p class="text-base font-medium text-gray-500">å…¥åŠ›å¾…ã¡</p>
            </div>

            <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="errorMessage" class="hidden p-3 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-md text-center font-medium">
                <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«å…¥ã‚‹ -->
            </div>
        </div>
        
        <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®è¿½åŠ  -->
        <button id="resetButton" onclick="resetForm()"
                class="w-full mt-4 py-2 bg-gray-400 hover:bg-gray-500 text-white font-bold rounded-lg shadow-md transform transition active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-gray-300">
            å…¨å…¥åŠ›ã¨ã‚¹ãƒ­ãƒƒãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
        </button>
        
        <!-- index.htmlã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ (æ–°è¦è¿½åŠ ) -->
        <a href="index.html" class="w-full mt-4 py-2 text-center inline-block bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-lg shadow-md transform transition active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-300">
            ãƒ„ãƒ¼ãƒ«é›†ã«æˆ»ã‚‹
        </a>


        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ã‚¨ãƒªã‚¢ - ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ç¸®å° -->
        <div class="mt-8 pt-4 border-t border-gray-200 text-center">
            <p class="text-xs text-gray-500 mb-1">
                **è£½ä½œè€…æƒ…å ±:** X: nek0n0tem0
            </p>
            <p class="text-2xs text-red-500 font-medium">
                â€» ã“ã®ã‚¢ãƒ—ãƒªã§ã¯å…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜æ©Ÿèƒ½ã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã€‚
            </p>
        </div>
    </div>

    <script>
        // æœ€å¤§å…¥åŠ›ã‚¹ãƒ­ãƒƒãƒˆæ•°
        const NUM_SLOTS = 6; 
        // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å‘³æ–¹ã‚¹ãƒ­ãƒƒãƒˆæ•°
        let currentMySlotCount = 1; 
        // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ•µã‚¹ãƒ­ãƒƒãƒˆæ•°
        let currentEnemySlotCount = 1; 

        // å±æ€§é–“ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆæˆ¦åŠ›ï¼‰ä¹—æ•°ãƒ†ãƒ¼ãƒ–ãƒ«
        const multipliers = {
            'fire': { 'fire': 1.00, 'water': 0.80, 'grass': 1.25 },
            'water': { 'fire': 1.25, 'water': 1.00, 'grass': 0.80 },
            'grass': { 'fire': 0.80, 'water': 1.25, 'grass': 1.00 }
        };

        // ç­ã®è¨ˆç®—ã«ä½¿ç”¨ã™ã‚‹å›ºå®šä¿‚æ•°
        const SQUAD_SCALING_FACTOR = 80;

        // å±æ€§ã®æ—¥æœ¬èªè¡¨ç¤ºå
        const attributeNames = {
            'fire': 'ğŸ”¥ ç«',
            'water': 'ğŸ’§ æ°´',
            'grass': 'ğŸŒ¿ è‰'
        };
        
        // åˆæœŸé¸æŠå±æ€§ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚æœ€å¤§6çµ„ã‚’å®šç¾©ã€‚
        let selectedAttributes = {};
        for (let i = 1; i <= NUM_SLOTS; i++) {
            // åˆæœŸå€¤ã‚’ã™ã¹ã¦ 'fire' (ç«) ã«è¨­å®š
            selectedAttributes['my' + i] = 'fire';
            selectedAttributes['enemy' + i] = 'fire';
        }

        /**
         * å‘³æ–¹ã‚¹ãƒ­ãƒƒãƒˆã‚’ä¸€ã¤å±•é–‹ã™ã‚‹
         */
        function addMySlot() {
            if (currentMySlotCount < NUM_SLOTS) {
                currentMySlotCount++;

                // æ¬¡ã®å‘³æ–¹ã‚¹ãƒ­ãƒƒãƒˆã‚’è¡¨ç¤º
                const mySlot = document.getElementById(`mySlot${currentMySlotCount}`);
                if (mySlot) mySlot.classList.remove('hidden');

                // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
                const button = document.getElementById('myAddSlotButton');
                button.textContent = `å‘³æ–¹ä¸»åŠ›è¿½åŠ  (ç¾åœ¨ ${currentMySlotCount} / ${NUM_SLOTS})`;
                
                // æœ€å¤§ã‚¹ãƒ­ãƒƒãƒˆã«é”ã—ãŸã‚‰ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                if (currentMySlotCount === NUM_SLOTS) {
                    button.classList.add('hidden');
                }
                
                calculateDebuff(); // ã‚¹ãƒ­ãƒƒãƒˆè¿½åŠ æ™‚ã«å†è¨ˆç®—
            }
        }
        
        /**
         * æ•µã‚¹ãƒ­ãƒƒãƒˆã‚’ä¸€ã¤å±•é–‹ã™ã‚‹
         */
        function addEnemySlot() {
            if (currentEnemySlotCount < NUM_SLOTS) {
                currentEnemySlotCount++;

                // æ¬¡ã®æ•µã‚¹ãƒ­ãƒƒãƒˆã‚’è¡¨ç¤º
                const enemySlot = document.getElementById(`enemySlot${currentEnemySlotCount}`);
                if (enemySlot) enemySlot.classList.remove('hidden');

                // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
                const button = document.getElementById('enemyAddSlotButton');
                button.textContent = `æ•µä¸»åŠ›è¿½åŠ  (ç¾åœ¨ ${currentEnemySlotCount} / ${NUM_SLOTS})`;
                
                // æœ€å¤§ã‚¹ãƒ­ãƒƒãƒˆã«é”ã—ãŸã‚‰ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                if (currentEnemySlotCount === NUM_SLOTS) {
                    button.classList.add('hidden');
                }
                
                calculateDebuff(); // ã‚¹ãƒ­ãƒƒãƒˆè¿½åŠ æ™‚ã«å†è¨ˆç®—
            }
        }

        /**
         * ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
         */
        function resetForm() {
            // 1. å…¨ã¦ã®æˆ¦åŠ›å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç©ºã«ã™ã‚‹
            for (let i = 1; i <= NUM_SLOTS; i++) {
                const myPowerInput = document.getElementById('myPower' + i);
                const enemyPowerInput = document.getElementById('enemyPower' + i);
                if (myPowerInput) myPowerInput.value = '';
                if (enemyPowerInput) enemyPowerInput.value = '';
            }

            // 2. ä¸»åŠ›2ä»¥é™ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’éè¡¨ç¤ºã«æˆ»ã™
            for (let i = 2; i <= NUM_SLOTS; i++) {
                const mySlot = document.getElementById(`mySlot${i}`);
                const enemySlot = document.getElementById(`enemySlot${i}`);
                if (mySlot) mySlot.classList.add('hidden');
                if (enemySlot) enemySlot.classList.add('hidden');
            }

            // 3. å±æ€§ã‚’åˆæœŸå€¤ï¼ˆ'fire'ï¼‰ã«ãƒªã‚»ãƒƒãƒˆã—ã€UIã‚’æ›´æ–° (è¿½åŠ )
            for (let i = 1; i <= NUM_SLOTS; i++) {
                // selectedAttributes ã®å€¤ã‚’ãƒªã‚»ãƒƒãƒˆ
                selectedAttributes['my' + i] = 'fire';
                selectedAttributes['enemy' + i] = 'fire';

                // UIã®å±æ€§ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–° (å†è¨ˆç®—ã¯æœ€å¾Œã«è¡Œã†ãŸã‚ false)
                selectAttribute('my', i, 'fire', false);
                selectAttribute('enemy', i, 'fire', false);
            }

            // 4. ã‚¹ãƒ­ãƒƒãƒˆæ•°ã‚’1ã«ãƒªã‚»ãƒƒãƒˆã—ã€ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
            currentMySlotCount = 1;
            currentEnemySlotCount = 1;
            
            const myButton = document.getElementById('myAddSlotButton');
            const enemyButton = document.getElementById('enemyAddSlotButton');
            
            myButton.textContent = `å‘³æ–¹ä¸»åŠ›è¿½åŠ  (ç¾åœ¨ ${currentMySlotCount} / ${NUM_SLOTS})`;
            enemyButton.textContent = `æ•µä¸»åŠ›è¿½åŠ  (ç¾åœ¨ ${currentEnemySlotCount} / ${NUM_SLOTS})`;
            
            myButton.classList.remove('hidden');
            enemyButton.classList.remove('hidden');

            // 5. è¨ˆç®—çµæœã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
            calculateDebuff(); 
        }

        // åˆæœŸé¸æŠçŠ¶æ…‹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        document.addEventListener('DOMContentLoaded', () => {
            // å…¨ã¦ã®ä¸»åŠ›ã«å¯¾ã—ã¦åˆæœŸå±æ€§ã‚’è¨­å®š
            for (let i = 1; i <= NUM_SLOTS; i++) {
                // åˆæœŸå±æ€§ã¨ã—ã¦ 'fire' ã‚’é¸æŠã—ã€ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
                selectAttribute('my', i, selectedAttributes['my' + i], false);
                selectAttribute('enemy', i, selectedAttributes['enemy' + i], false);
            }
            
            // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«ä¸€åº¦è¨ˆç®—ã‚’å®Ÿè¡Œ
            calculateDebuff();
        });

        /**
         * å±æ€§ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹
         */
        function selectAttribute(type, num, attribute, recalculate = true) {
            const container = document.getElementById(type + 'Attribute' + num);
            if (!container) return;

            // é¸æŠã•ã‚ŒãŸå±æ€§ã‚’ä¿å­˜
            selectedAttributes[type + num] = attribute;

            // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            container.querySelectorAll('.attribute-button').forEach(button => {
                button.classList.remove('selected', 'ring-4', 'ring-indigo-300', 'ring-red-300', button.dataset.bg);
                button.style.color = '#4b5563'; // gray-600
                button.borderColor = '#d1d5db'; // gray-300
            });

            // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«é¸æŠçŠ¶æ…‹ã‚’é©ç”¨
            const selectedButton = container.querySelector(`[data-attribute="${attribute}"]`);
            if (selectedButton) {
                selectedButton.classList.add('selected', 'ring-4');
                
                selectedButton.classList.add(selectedButton.dataset.bg);
                selectedButton.style.color = 'white'; 
                
                if (type === 'my') {
                    selectedButton.classList.add('ring-indigo-300');
                    selectedButton.style.borderColor = '#4f46e5'; 
                } else {
                    selectedButton.classList.add('ring-red-300');
                    selectedButton.style.borderColor = '#dc2626'; 
                }
            }

            if (recalculate) {
                calculateDebuff();
            }
        }


        /**
         * ãƒ‡ãƒãƒ•è¨ˆç®—ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
         */
        function calculateDebuff() {
            const errorMessageDiv = document.getElementById('errorMessage');
            const outputDiv = document.getElementById('output');
            const timeEstimateDiv = document.getElementById('timeEstimate');
            
            errorMessageDiv.classList.add('hidden');
            
            let totalEffectiveMyPower = 0;
            let totalEnemyPower = 0;
            let hasValidInput = false;
            let multiplierDetailsHtml = '';

            // 1. æ•µã®åˆè¨ˆæˆ¦åŠ› (totalEnemyPower) ã®è¨ˆç®—
            // å±•é–‹ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®æ•µã‚¹ãƒ­ãƒƒãƒˆã®æˆ¦åŠ›ã‚’åˆè¨ˆã™ã‚‹ (i <= currentEnemySlotCount)
            for (let i = 1; i <= currentEnemySlotCount; i++) {
                const enemyPowerInput = document.getElementById('enemyPower' + i);
                const enemyPower = parseFloat(enemyPowerInput?.value) || 0;
                totalEnemyPower += enemyPower;
            }
            
            // 2. å‘³æ–¹ã®æœ‰åŠ¹åˆè¨ˆæˆ¦åŠ› (totalEffectiveMyPower) ã®è¨ˆç®—
            // è¨ˆç®—ã«å±æ€§è£œæ­£ã‚’å«ã‚ã‚‹ã‚¹ãƒ­ãƒƒãƒˆæ•°ã¯ã€å‘³æ–¹ã¨æ•µã®å±•é–‹ã•ã‚Œã¦ã„ã‚‹ã‚¹ãƒ­ãƒƒãƒˆæ•°ã®ã€Œå°‘ãªã„æ–¹ã€ã«åˆã‚ã›ã‚‹
            const effectiveCalculationLimit = Math.min(currentMySlotCount, currentEnemySlotCount);

            for (let i = 1; i <= effectiveCalculationLimit; i++) {
                const myPowerInput = document.getElementById('myPower' + i);
                const enemyPowerInput = document.getElementById('enemyPower' + i);
                
                const myPower = parseFloat(myPowerInput?.value) || 0;
                const enemyPower = parseFloat(enemyPowerInput?.value) || 0;

                // ãƒšã‚¢ä¸¡æ–¹ã«æœ‰åŠ¹ãªå…¥åŠ›ãŒã‚ã‚‹å ´åˆã®ã¿å±æ€§è£œæ­£è¨ˆç®—ã«å«ã‚ã‚‹
                if (myPower > 0 && enemyPower > 0) {
                    hasValidInput = true;
                    
                    const myAttr = selectedAttributes['my' + i];
                    const enemyAttr = selectedAttributes['enemy' + i];

                    const multiplier = multipliers[myAttr]?.[enemyAttr] || 1.00;
                    const effectiveMyPower = myPower * multiplier;

                    totalEffectiveMyPower += effectiveMyPower;
                    
                    // å±æ€§è£œæ­£è©³ç´°ã®å‹•çš„ç”Ÿæˆ
                    multiplierDetailsHtml += `
                        <p class="text-xs sm:text-sm">
                            <span class="font-bold text-indigo-700">ä¸»åŠ›${i}</span> 
                            (${attributeNames[myAttr]} vs ${attributeNames[enemyAttr]}) :
                            <span class="font-bold text-base">${multiplier.toFixed(2)}</span>å€
                        </p>
                    `;
                }
            }
            
            // æ•µã®åˆè¨ˆæˆ¦åŠ›ãŒ0ã€ã¾ãŸã¯æœ‰åŠ¹ãªå‘³æ–¹ã®æˆ¦åŠ›ãŒãªã„å ´åˆã¯è¨ˆç®—ã‚’åœæ­¢
            if (totalEnemyPower === 0) {
                // æ•µã®æˆ¦åŠ›ãŒã‚¼ãƒ­ã®å ´åˆã¯ã€è¨ˆç®—ã‚’åœæ­¢ã—ã€å…¥åŠ›å¾…ã¡çŠ¶æ…‹ã‚’ç¶­æŒ
                hasValidInput = false;
            }


            // å¿…é ˆå…¥åŠ›é …ç›®ã®ãƒã‚§ãƒƒã‚¯ (æœ‰åŠ¹ãªå…¥åŠ›ãŒ1çµ„ã§ã‚‚ãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼/å…¥åŠ›å¾…ã¡)
            if (!hasValidInput) {
                errorMessageDiv.textContent = 'å°‘ãªãã¨ã‚‚1çµ„ã®æˆ¦åŠ›ã«1ä»¥ä¸Šã®æ­£ã®æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                errorMessageDiv.classList.remove('hidden');
                
                document.getElementById('neededSquads').textContent = 'å…¥åŠ›å¾…ã¡';
                document.getElementById('neededPeople').textContent = 'å…¥åŠ›å¾…ã¡';
                document.getElementById('effectiveTotalPower').textContent = '0';
                document.getElementById('enemyTotalPower').textContent = totalEnemyPower.toFixed(2);
                document.getElementById('multiplierText').innerHTML = '<p class="text-sm text-gray-500">ä¸»åŠ›ã”ã¨ã®å±æ€§è£œæ­£ç‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™ (å…¥åŠ›ãŒã‚ã£ãŸçµ„ã®ã¿)</p>';

                // çµæœã‚¨ãƒªã‚¢ã®è‰²ã‚’å…¥åŠ›å¾…ã¡ï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰ã«
                outputDiv.classList.remove('bg-green-100', 'border-green-300', 'bg-blue-100', 'border-blue-300');
                outputDiv.classList.add('bg-gray-100', 'border-gray-300');
                
                // æ™‚é–“è¡¨ç¤ºã‚‚å…¥åŠ›å¾…ã¡ã«
                timeEstimateDiv.innerHTML = `<p class="text-lg text-gray-700 font-semibold mb-2">ãƒ‡ãƒãƒ•ã«ã‹ã‹ã‚‹æ™‚é–“ã®ç›®å®‰</p><p class="text-base font-medium text-gray-500">å…¥åŠ›å¾…ã¡</p>`;
                
                return;
            }

            // ã‚¨ãƒ©ãƒ¼ãŒãªã„å ´åˆã€çµæœã‚¨ãƒªã‚¢ã®è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
            outputDiv.classList.remove('bg-gray-100', 'border-gray-300');


            // 3. åˆè¨ˆæˆ¦åŠ›ã¨å±æ€§è£œæ­£è©³ç´°ã®è¡¨ç¤º
            
            document.getElementById('effectiveTotalPower').textContent = totalEffectiveMyPower.toFixed(2);
            document.getElementById('enemyTotalPower').textContent = totalEnemyPower.toFixed(2);
            
            // å±æ€§è£œæ­£ãƒ†ã‚­ã‚¹ãƒˆã®æ›´æ–°
            document.getElementById('multiplierText').innerHTML = multiplierDetailsHtml;


            // 4. ä¸è¶³ç‡ã¨ç­æ•°ã®è¨ˆç®—
            
            // æ•µæˆ¦åŠ›ã«å¯¾ã™ã‚‹æœ‰åŠ¹æˆ¦åŠ›ã®ä¸è¶³ç‡ã‚’è¨ˆç®—
            const deficitRatio = 1 - (totalEffectiveMyPower / totalEnemyPower);

            let neededSquads = 0;
            let neededPeople = 0;
            
            // ä¸è¶³ç‡ãŒ0ã‚ˆã‚Šå¤§ãã„å ´åˆã€ç­ã®è¨ˆç®—ã‚’å®Ÿè¡Œ
            if (deficitRatio > 0) {
                // ä¸è¶³ç‡ã«å®šæ•°80ã‚’ä¹—ã˜ã‚‹
                const squadCalculationBase = deficitRatio * SQUAD_SCALING_FACTOR;
                
                // åˆ‡ã‚Šä¸Šã’
                const roundedSquads = Math.ceil(squadCalculationBase);
                
                neededSquads = Math.max(0, roundedSquads);
                
                // äººæ•°è¨ˆç®—
                neededPeople = neededSquads * 6;
            }

            // 5. æœ€çµ‚çµæœã®è¡¨ç¤º
            document.getElementById('neededSquads').textContent = `${neededSquads} ç­`;
            document.getElementById('neededPeople').textContent = `${neededPeople} äºº`;
            
            // å¿…è¦ãªç­æ•°ãŒ0ã®å ´åˆã®ç‰¹åˆ¥è¡¨ç¤º
            if (neededSquads === 0) {
                outputDiv.classList.remove('bg-green-100', 'border-green-300');
                outputDiv.classList.add('bg-blue-100', 'border-blue-300');
                document.getElementById('neededSquads').textContent = 'ä¸è¦ (æˆ¦åŠ›å„ªä½)';
                document.getElementById('neededPeople').textContent = 'ä¸è¦ (æˆ¦åŠ›å„ªä½)';
                
                // æ™‚é–“è¡¨ç¤ºã‚‚ä¸è¦ã«
                timeEstimateDiv.innerHTML = `<p class="text-lg text-gray-700 font-semibold mb-2">ãƒ‡ãƒãƒ•ã«ã‹ã‹ã‚‹æ™‚é–“ã®ç›®å®‰</p><p class="text-base font-medium text-blue-700">ä¸è¦</p>`;
            } else {
                outputDiv.classList.remove('bg-blue-100', 'border-blue-300');
                outputDiv.classList.add('bg-green-100', 'border-green-300');
                
                // 6. æ™‚é–“ã®è¨ˆç®—ã¨è¡¨ç¤º (æ–‡å­—è‰²ã‚’ä¿®æ­£)
                const timeLv1 = neededSquads * 4;
                const timeLv2 = neededSquads * 3;
                const timeLv3 = neededSquads * 2;

                const timeHtml = `
                    <p class="text-lg text-gray-700 font-semibold mb-2">ãƒ‡ãƒãƒ•ã«ã‹ã‹ã‚‹æ™‚é–“ã®ç›®å®‰</p>
                    <div class="space-y-2 text-left p-2 bg-indigo-100 rounded-lg">
                        <p class="text-base font-medium">Lv.1 (ã‚¿ã‚¦ãƒ³: 4ç§’/ç­): 
                            <span class="font-extrabold text-indigo-800">${timeLv1} ç§’</span> 
                            <span class="text-sm text-gray-600">(${ (timeLv1 / 60).toFixed(2) } åˆ†)</span>
                        </p>
                        <p class="text-base font-medium">Lv.2 (å¯®: 3ç§’/ç­): 
                            <span class="font-extrabold text-blue-700">${timeLv2} ç§’</span> 
                            <span class="text-sm text-gray-600">(${ (timeLv2 / 60).toFixed(2) } åˆ†)</span>
                        </p>
                        <p class="text-base font-medium">Lv.3 (åŸ: 2ç§’/ç­): 
                            <span class="font-extrabold text-red-700">${timeLv3} ç§’</span> 
                            <span class="text-sm text-gray-600">(${ (timeLv3 / 60).toFixed(2) } åˆ†)</span>
                        </p>
                    </div>
                `;
                timeEstimateDiv.innerHTML = timeHtml;
            }
        }
    </script>
</body>
</html>
