<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒ•è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7ffec; /* æŸ”ã‚‰ã‹ãªèƒŒæ™¯è‰² */
        }
        .card {
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* æœ€å¾Œã®é …ç›®ã‹ã‚‰ä¸‹ç·šã‚’å–ã‚Šé™¤ã */
        #timeResults > div:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div id="app" class="w-full max-w-xl bg-white p-6 sm:p-8 rounded-xl card border border-gray-200">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6 border-b pb-2">
            ãƒ‡ãƒãƒ•è¨ˆç®—ãƒ„ãƒ¼ãƒ«
        </h1>

        <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="space-y-6">
            <!-- å‘³æ–¹å´ã®å…¥åŠ› -->
            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4">
                    <span class="mr-2">ğŸ›¡ï¸</span>å‘³æ–¹æƒ…å ±
                </h2>
                <!-- æˆ¦åŠ›å…¥åŠ› -->
                <div class="mb-4">
                    <label for="myPower" class="block text-sm font-medium text-gray-700">
                        è‡ªåˆ†ã®æˆ¦åŠ› (ä¸‡å˜ä½)
                    </label>
                    <!-- åˆæœŸå€¤ã‚’ç©ºæ¬„ã«ä¿®æ­£ -->
                    <input type="number" id="myPower" value="" min="1"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500 transition">
                </div>
                <!-- å±æ€§é¸æŠã‚¨ãƒªã‚¢ã¯å‰Šé™¤ã—ã¾ã—ãŸ -->
            </div>

            <!-- æ•µå´ã®å…¥åŠ› -->
            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                <h2 class="text-xl font-semibold text-red-700 mb-4">
                    <span class="mr-2">âš”ï¸</span>æ•µæƒ…å ±
                </h2>
                <!-- æˆ¦åŠ›å…¥åŠ› -->
                <div class="mb-4">
                    <label for="enemyPower" class="block text-sm font-medium text-gray-700">
                        ç›¸æ‰‹ã®æˆ¦åŠ› (ä¸‡å˜ä½)
                    </label>
                    <!-- åˆæœŸå€¤ã‚’ç©ºæ¬„ã«ä¿®æ­£ -->
                    <input type="number" id="enemyPower" value="" min="1"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:border-red-500 focus:ring-red-500 transition">
                </div>
                <!-- å±æ€§é¸æŠã‚¨ãƒªã‚¢ã¯å‰Šé™¤ã—ã¾ã—ãŸ -->
            </div>
        </div>

        <!-- ã€Œè¨ˆç®—ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã¯å‰Šé™¤ã—ã¾ã—ãŸã€‚å…¥åŠ›æ™‚ã«è‡ªå‹•ã§è¨ˆç®—ã•ã‚Œã¾ã™ã€‚ -->

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="results" class="mt-8 pt-6 border-t border-gray-300 space-y-4">
            <h2 class="text-2xl font-bold text-gray-800 text-center">
                è¨ˆç®—çµæœ
            </h2>
            
            <div id="output" class="text-center p-4 rounded-lg bg-green-100 border border-green-300">
                
                <p class="text-lg text-gray-700 font-semibold mb-2">å¿…è¦ãªç­ã®æ•° (6äºº/ç­)</p>
                <p id="neededSquads" class="text-4xl font-extrabold text-green-800">- ç­</p>
                
                <p class="text-lg text-gray-700 font-semibold mb-2 mt-4">å¿…è¦ãªè¿½åŠ äººæ•°</p>
                <p id="neededPeople" class="text-3xl font-extrabold text-green-700">- äºº</p>
                
                <!-- å¼±ä½“åŒ–ç‡ã®è¡¨ç¤ºã‚’ç§»å‹• -->
                <p class="text-lg text-gray-700 font-semibold mb-2 mt-4">å¼±ä½“åŒ–ç‡ (ãƒ‡ãƒãƒ•ç‡)</p>
                <p id="debuffRate" class="text-3xl font-extrabold text-red-600">- %</p>
            </div>
            
            <!-- ä¿®æ­£: ã‹ã‹ã‚‹æ™‚é–“è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’ç¸¦ä¸¦ã³(flex-col)ã«ä¿®æ­£ -->
            <h3 class="text-xl font-bold text-gray-700 text-center pt-4 border-t border-gray-200">
                ãƒ‡ãƒãƒ•ã«ã‹ã‹ã‚‹æ™‚é–“ã®ç›®å®‰
            </h3>
            <div id="timeResults" class="flex flex-col space-y-0 p-3 bg-white rounded-lg border border-gray-300">
                
                <!-- Lv.1 (ã‚¿ã‚¦ãƒ³) -->
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                    <span class="font-semibold text-gray-700 text-sm sm:text-base">Lv.1 (ã‚¿ã‚¦ãƒ³: 4ç§’/ç­)</span>
                    <span class="text-lg font-bold text-indigo-700">
                        <span id="timeLv1Sec">- ç§’</span> 
                        <span id="timeLv1Min" class="text-sm font-normal text-gray-500 ml-1">(- åˆ†)</span>
                    </span>
                </div>
                
                <!-- Lv.2 (å¯®) -->
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                    <span class="font-semibold text-gray-700 text-sm sm:text-base">Lv.2 (å¯®: 3ç§’/ç­)</span>
                    <span class="text-lg font-bold text-blue-700">
                        <span id="timeLv2Sec">- ç§’</span> 
                        <span id="timeLv2Min" class="text-sm font-normal text-gray-500 ml-1">(- åˆ†)</span>
                    </span>
                </div>
                
                <!-- Lv.3 (åŸ) -->
                <div class="flex justify-between items-center py-2">
                    <span class="font-semibold text-gray-700 text-sm sm:text-base">Lv.3 (åŸ: 2ç§’/ç­)</span>
                    <span class="text-lg font-bold text-red-700">
                        <span id="timeLv3Sec">- ç§’</span> 
                        <span id="timeLv3Min" class="text-sm font-normal text-gray-500 ml-1">(- åˆ†)</span>
                    </span>
                </div>
            </div>
            
            <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="errorMessage" class="hidden p-3 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-md text-center font-medium">
                <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«å…¥ã‚‹ -->
            </div>
        </div>
        
        <!-- ä¿®æ­£: ãƒ„ãƒ¼ãƒ«é›†ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ -->
        <div class="text-center mt-6">
            <button onclick="window.location.href='https://nek0-tkdb.github.io/tools/';" 
                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out text-sm">
                â† ãƒ„ãƒ¼ãƒ«é›†ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹
            </button>
        </div>
        
        <!-- ãƒ•ãƒƒã‚¿ãƒ¼æƒ…å ± -->
        <div class="mt-4 pt-4 border-t border-gray-200 text-center text-xs text-gray-500 space-y-1">
            <p>X: nek0n0tem0</p>
            <p>â€»ã“ã®ã‚¢ãƒ—ãƒªã§ã¯ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½ã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“</p>
        </div>
    </div>

    <script>
        // ç­ã®è¨ˆç®—ã«ä½¿ç”¨ã™ã‚‹å›ºå®šä¿‚æ•° (å…ƒã®ã‚¢ãƒ—ãƒªã‹ã‚‰æµç”¨)
        const SQUAD_SCALING_FACTOR = 80;

        // ã‹ã‹ã‚‹æ™‚é–“ã®ä¿‚æ•° (ç§’/ç­)
        const TIME_COEFFICIENTS = {
            lv1: 4, // ã‚¿ã‚¦ãƒ³
            lv2: 3, // å¯®
            lv3: 2  // åŸ (2ç§’/ç­ã¨è§£é‡ˆ)
        };

        // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã®è¨­å®š
        document.addEventListener('DOMContentLoaded', () => {
            // å…¥åŠ›æ¬„ã®å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰å†è¨ˆç®—ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            document.getElementById('myPower').addEventListener('input', calculateDebuff);
            document.getElementById('enemyPower').addEventListener('input', calculateDebuff);
        });


        /**
         * å±æ€§è£œæ­£ã‚’ç„¡è¦–ã—ã€æˆ¦åŠ›ã®å·®ã«åŸºã¥ã„ã¦å¿…è¦ãªç­ã®æ•°ã¨äººæ•°ã‚’è¨ˆç®—ã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
         */
        function calculateDebuff() {
            const myPowerInput = document.getElementById('myPower');
            const enemyPowerInput = document.getElementById('enemyPower');
            const errorMessageDiv = document.getElementById('errorMessage');
            const outputDiv = document.getElementById('output');
            
            errorMessageDiv.classList.add('hidden');
            outputDiv.classList.remove('bg-blue-100', 'border-blue-300');
            outputDiv.classList.add('bg-green-100', 'border-green-300');

            // 1. å…¥åŠ›å€¤ã®å–å¾—ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            const myPower = parseFloat(myPowerInput.value);
            const enemyPower = parseFloat(enemyPowerInput.value);

            // å€¤ãŒç©ºã®å ´åˆã€ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãçµæœè¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
            if (myPowerInput.value === "" || enemyPowerInput.value === "") {
                document.getElementById('neededSquads').textContent = '- ç­';
                document.getElementById('debuffRate').textContent = '- %'; // NEW: å¼±ä½“åŒ–ç‡ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('neededPeople').textContent = '- äºº';
                document.getElementById('timeLv1Sec').textContent = '- ç§’';
                document.getElementById('timeLv2Sec').textContent = '- ç§’';
                document.getElementById('timeLv3Sec').textContent = '- ç§’';
                document.getElementById('timeLv1Min').textContent = '(- åˆ†)';
                document.getElementById('timeLv2Min').textContent = '(- åˆ†)';
                document.getElementById('timeLv3Min').textContent = '(- åˆ†)';
                return;
            }

            if (isNaN(myPower) || myPower <= 0 || isNaN(enemyPower) || enemyPower <= 0) {
                errorMessageDiv.textContent = 'æˆ¦åŠ›ã«ã¯1ä»¥ä¸Šã®æ­£ã®æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                errorMessageDiv.classList.remove('hidden');
                document.getElementById('neededSquads').textContent = '- ç­';
                document.getElementById('debuffRate').textContent = '- %'; // NEW: å¼±ä½“åŒ–ç‡ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('neededPeople').textContent = '- äºº';
                document.getElementById('timeLv1Sec').textContent = '- ç§’';
                document.getElementById('timeLv2Sec').textContent = '- ç§’';
                document.getElementById('timeLv3Sec').textContent = '- ç§’';
                document.getElementById('timeLv1Min').textContent = '(- åˆ†)';
                document.getElementById('timeLv2Min').textContent = '(- åˆ†)';
                document.getElementById('timeLv3Min').textContent = '(- åˆ†)';
                return;
            }

            // 2. å±æ€§è£œæ­£ã‚’ç„¡è¦–ã—ã€ä¹—æ•° M = 1.00 ã¨ã™ã‚‹
            const multiplier = 1.00;
            
            // 3. æœ‰åŠ¹æˆ¦åŠ› (å±æ€§è£œæ­£ãªã—) ã¨ä¸è¶³ç‡ã®è¨ˆç®—
            const effectiveMyPower = myPower * multiplier;
            
            // æ•µæˆ¦åŠ›ã«å¯¾ã™ã‚‹æˆ¦åŠ›ã®ä¸è¶³ç‡ã‚’è¨ˆç®—: (1 - P_my / P_enemy)
            const deficitRatio = 1 - (effectiveMyPower / enemyPower);

            // NEW: å¼±ä½“åŒ–ç‡ã®åˆæœŸåŒ–ã¨è¨ˆç®—
            let debuffRate = 0;
            
            let neededSquads = 0;
            let neededPeople = 0;
            
            // 4. ä¸è¶³ç‡ãŒ0ã‚ˆã‚Šå¤§ãã„å ´åˆã€ç­ã®è¨ˆç®—ã‚’å®Ÿè¡Œ
            if (deficitRatio > 0) {
                // ä¸è¶³ç‡ã‚’ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã«å¤‰æ›ã—ã€å°æ•°ç‚¹ä»¥ä¸‹2æ¡ã§ä¸¸ã‚ã‚‹
                debuffRate = (deficitRatio * 100).toFixed(2);
                
                // ä¸è¶³ç‡ã«å®šæ•°80ã‚’ä¹—ã˜ã‚‹: (1 - Ratio) * 80
                const squadCalculationBase = deficitRatio * SQUAD_SCALING_FACTOR;
                
                // åˆ‡ã‚Šä¸Šã’: ROUNDUP(...)
                const roundedSquads = Math.ceil(squadCalculationBase);
                
                // max(0, ...)
                neededSquads = Math.max(0, roundedSquads);
                
                // 5. äººæ•°ã‚’è¨ˆç®— (1ç­ = 6äºº)
                neededPeople = neededSquads * 6;
            } else {
                // è‡ªåˆ†ã®æˆ¦åŠ›ãŒæ•µä»¥ä¸Šã®å ´åˆã€å¼±ä½“åŒ–ç‡ã¯0%
                debuffRate = (0).toFixed(2);
            }

            // 6. çµæœã®è¡¨ç¤º
            document.getElementById('neededSquads').textContent = `${neededSquads} ç­`;
            document.getElementById('neededPeople').textContent = `${neededPeople} äºº`;
            document.getElementById('debuffRate').textContent = `${debuffRate} %`; // NEW: å¼±ä½“åŒ–ç‡ã®è¡¨ç¤º
            
            // 7. ã‹ã‹ã‚‹æ™‚é–“ã®è¨ˆç®—ã¨è¡¨ç¤º (ç§’ã¨åˆ†)
            const timeLv1Sec = neededSquads * TIME_COEFFICIENTS.lv1;
            const timeLv2Sec = neededSquads * TIME_COEFFICIENTS.lv2;
            const timeLv3Sec = neededSquads * TIME_COEFFICIENTS.lv3;
            
            const timeLv1Min = (timeLv1Sec / 60).toFixed(2);
            const timeLv2Min = (timeLv2Sec / 60).toFixed(2);
            const timeLv3Min = (timeLv3Sec / 60).toFixed(2);

            document.getElementById('timeLv1Sec').textContent = `${timeLv1Sec} ç§’`;
            document.getElementById('timeLv2Sec').textContent = `${timeLv2Sec} ç§’`;
            document.getElementById('timeLv3Sec').textContent = `${timeLv3Sec} ç§’`;
            
            document.getElementById('timeLv1Min').textContent = `(${timeLv1Min} åˆ†)`;
            document.getElementById('timeLv2Min').textContent = `(${timeLv2Min} åˆ†)`;
            document.getElementById('timeLv3Min').textContent = `(${timeLv3Min} åˆ†)`;
            
            // å¿…è¦ãªç­æ•°ãŒ0ã®å ´åˆã®ç‰¹åˆ¥è¡¨ç¤º
            if (neededSquads === 0) {
                document.getElementById('neededSquads').textContent = 'ä¸è¦';
                document.getElementById('neededPeople').textContent = 'ä¸è¦';
                document.getElementById('timeLv1Sec').textContent = 'ä¸è¦';
                document.getElementById('timeLv2Sec').textContent = 'ä¸è¦';
                document.getElementById('timeLv3Sec').textContent = 'ä¸è¦';
                document.getElementById('timeLv1Min').textContent = '';
                document.getElementById('timeLv2Min').textContent = '';
                document.getElementById('timeLv3Min').textContent = '';
                outputDiv.classList.remove('bg-green-100', 'border-green-300');
                outputDiv.classList.add('bg-blue-100', 'border-blue-300'); // é’ç³»ã®è‰²ã«å¤‰æ›´
            } else {
                outputDiv.classList.remove('bg-blue-100', 'border-blue-300');
                outputDiv.classList.add('bg-green-100', 'border-green-300'); // ç·‘ç³»ã®è‰²ã«å¤‰æ›´
            }
        }
    </script>
</body>
</html>
