// CSVを読み込んで解析する関数
const loadCSV = async () => {
    try {
        const response = await fetch('card_data.csv');
        if (!response.ok) throw new Error('card_data.csv が見つかりません。');
        
        const text = await response.text();
        const rows = text.split(/\r?\n/).filter(row => row.trim() !== '');
        if (rows.length < 2) throw new Error('CSVにデータが含まれていません。');

        // ヘッダー解析（日本語ヘッダーに対応）
        const headers = rows[0].split(',').map(h => h.trim());
        const nameIndex = headers.indexOf('キャラクター名');
        const urlIndex = headers.indexOf('画像URL');

        if (nameIndex === -1 || urlIndex === -1) {
            throw new Error('CSVに "キャラクター名" または "画像URL" の列が見つかりません。');
        }

        // データ解析とグループ化
        const groupedData = {};
        rows.slice(1).forEach(row => {
            // カンマで分割。URL等にカンマが含まれない前提ですが、
            // 前後の空白を削除してクリーンなデータを取り出します。
            const cols = row.split(',').map(c => c.trim());
            const name = cols[nameIndex];
            const url = cols[urlIndex];

            if (name && url) {
                if (!groupedData[name]) groupedData[name] = [];
                groupedData[name].push(url);
            }
        });

        charData.value = Object.keys(groupedData).map(name => ({
            name: name,
            urls: groupedData[name]
        }));
        
        loading.value = false;
    } catch (err) {
        console.error(err);
        error.value = err.message;
        loading.value = false;
    }
};
